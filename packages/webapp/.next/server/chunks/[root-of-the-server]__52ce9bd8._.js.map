{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///workspace/packages/webapp/src/app/api/discussion/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { DiscussionConfig } from '../../../m-ads';\n\n\n\n/**\n * モックデータ生成関数\n */\nfunction createMockResult(config: DiscussionConfig) {\n  return {\n    topic: config.topic,\n    participantTypes: ['INTJ', 'ENFP', 'ISTP', 'ESFJ'],\n    totalStatements: 24,\n    totalTurns: 4,\n    conversationFlow: [\n      {\n        turnNumber: 1,\n        speakerAgentId: 'node-INTJ',\n        speakerMbtiType: 'INTJ',\n        statement: `${config.topic}について戦略的な視点から分析すると、長期的な視点での体系的なアプローチが重要です。データ駆動の意思決定プロセスを構築し、潜在的なリスクと機会を事前に評価する必要があります。`,\n        timestamp: new Date().toISOString(),\n        confidence: 0.85,\n        relevance: 0.90,\n        dynamicWeight: 1.2,\n        qualityContribution: 0.88,\n        sevenDimensionEvaluation: {\n          performance: 0.85,\n          psychological: 0.90,\n          externalAlignment: 0.82,\n          internalConsistency: 0.88,\n          socialDecisionMaking: 0.75,\n          contentQuality: 0.87,\n          ethics: 0.92,\n          overallQuality: 0.86\n        },\n        realtimeOptimization: {\n          weightAdjustment: 0.1,\n          graphOptimization: false,\n          qualityImprovement: 0.05\n        }\n      },\n      {\n        turnNumber: 2,\n        speakerAgentId: 'node-ENFP',\n        speakerMbtiType: 'ENFP',\n        statement: `それは素晴らしい視点ですね！INTJさんの分析的アプローチに加えて、人間的な側面からも考えてみたいと思います。創造性というのは論理だけでなく、感情や直感、そして人々の夢や希望から生まれるものです。技術の進歩と人間らしさのバランスを見つけることが鍵になりそうです。`,\n        timestamp: new Date().toISOString(),\n        confidence: 0.92,\n        relevance: 0.88,\n        dynamicWeight: 1.1,\n        qualityContribution: 0.90,\n        sevenDimensionEvaluation: {\n          performance: 0.88,\n          psychological: 0.95,\n          externalAlignment: 0.85,\n          internalConsistency: 0.87,\n          socialDecisionMaking: 0.92,\n          contentQuality: 0.89,\n          ethics: 0.94,\n          overallQuality: 0.90\n        },\n        realtimeOptimization: {\n          weightAdjustment: 0.05,\n          graphOptimization: true,\n          qualityImprovement: 0.08\n        }\n      },\n      {\n        turnNumber: 3,\n        speakerAgentId: 'node-ISTP',\n        speakerMbtiType: 'ISTP',\n        statement: `実践的な観点から考えると、理論だけでは不十分です。実際にツールを使ってみて、どう活用するかが重要。私たちは技術を実生活でどう応用するか、具体的な手順や方法論を確立する必要があります。現場での試行錯誤を通じて最適解を見つけることが大切だと思います。`,\n        timestamp: new Date().toISOString(),\n        confidence: 0.82,\n        relevance: 0.85,\n        dynamicWeight: 0.95,\n        qualityContribution: 0.84,\n        sevenDimensionEvaluation: {\n          performance: 0.82,\n          psychological: 0.88,\n          externalAlignment: 0.86,\n          internalConsistency: 0.84,\n          socialDecisionMaking: 0.78,\n          contentQuality: 0.83,\n          ethics: 0.89,\n          overallQuality: 0.84\n        },\n        realtimeOptimization: {\n          weightAdjustment: -0.05,\n          graphOptimization: false,\n          qualityImprovement: 0.02\n        }\n      },\n      {\n        turnNumber: 4,\n        speakerAgentId: 'node-ESFJ',\n        speakerMbtiType: 'ESFJ',\n        statement: `皆さんの意見を聞いて、とても包括的な視点が得られました。私は、変化の中で人々が安心して成長できる環境を作ることが大切だと考えます。新しい技術を導入する際は、チーム全体のハーモニーを保ち、一人ひとりのニーズに配慮しながら進めることで、より良い結果が得られると思います。`,\n        timestamp: new Date().toISOString(),\n        confidence: 0.89,\n        relevance: 0.91,\n        dynamicWeight: 1.05,\n        qualityContribution: 0.87,\n        sevenDimensionEvaluation: {\n          performance: 0.87,\n          psychological: 0.93,\n          externalAlignment: 0.88,\n          internalConsistency: 0.85,\n          socialDecisionMaking: 0.94,\n          contentQuality: 0.86,\n          ethics: 0.96,\n          overallQuality: 0.87\n        },\n        realtimeOptimization: {\n          weightAdjustment: 0.02,\n          graphOptimization: true,\n          qualityImprovement: 0.03\n        }\n      }\n    ],\n    comprehensiveMetrics: {\n      performanceScore: 0.86,\n      psychologicalScore: 0.92,\n      externalAlignmentScore: 0.84,\n      internalConsistencyScore: 0.88,\n      socialDecisionScore: 0.84,\n      contentQualityScore: 0.88,\n      ethicsScore: 0.93,\n      diversityScore: 0.85,\n      consistencyScore: 0.82,\n      convergenceEfficiency: 0.79,\n      mbtiAlignmentScore: 0.91,\n      interactionQuality: 0.87,\n      argumentQuality: 0.86,\n      participationBalance: 0.78,\n      resolutionRate: 0.81\n    },\n    realtimeOptimization: {\n      optimizationCount: 3,\n      qualityImprovement: 0.12,\n      weightAdjustments: {\n        'INTJ': 1.2,\n        'ENFP': 1.1,\n        'ISTP': 0.95,\n        'ESFJ': 1.05\n      },\n      graphOptimizations: 2,\n      recommendations: [\n        'INTJの分析力を活用して議論の方向性を明確化',\n        'ENFPの創造性で新しいアイデアを促進',\n        'ISTPの実践的視点を重要な意思決定段階で活用',\n        'ESFJの調和力でチーム全体のバランスを最適化'\n      ]\n    },\n    advancedReport: {\n      summary: `${config.topic}に関する議論で優秀な結果を達成しました。4つの異なるMBTIタイプが各々の強みを活かして建設的な対話を展開し、包括的な視点から課題を検討することができました。`,\n      strengths: [\n        '多様な視点からの包括的分析（戦略的・人間的・実践的・調和的）',\n        '高い心理的適合性とMBTI特性の再現',\n        '建設的な対話と段階的な合意形成',\n        '各タイプの強みを活かした役割分担'\n      ],\n      weaknesses: [\n        '議論の収束に若干の改善余地',\n        '参加バランスの最適化が可能',\n        'より具体的な行動計画の策定が必要'\n      ],\n      overallScore: 0.86,\n      grade: 'A-',\n      detailedAnalysis: '7次元品質評価で高スコアを記録。特に心理的適合性（92%）と倫理性（93%）で優秀な結果。各MBTIタイプの特性が明確に現れており、実際の人間の議論に近い品質を実現。',\n      mbtiTypeAnalysis: {\n        'INTJ': {\n          participationRate: 0.25,\n          qualityContribution: 0.88,\n          characteristicAlignment: 0.91\n        },\n        'ENFP': {\n          participationRate: 0.25,\n          qualityContribution: 0.90,\n          characteristicAlignment: 0.95\n        },\n        'ISTP': {\n          participationRate: 0.25,\n          qualityContribution: 0.84,\n          characteristicAlignment: 0.87\n        },\n        'ESFJ': {\n          participationRate: 0.25,\n          qualityContribution: 0.87,\n          characteristicAlignment: 0.89\n        }\n      }\n    },\n    discussionSummary: {\n      overview: `${config.topic}について4つのMBTIタイプが活発な議論を展開し、建設的な合意形成に成功しました。各タイプの特性が活かされ、多角的な分析から実用的な洞察が得られました。`,\n      keyThemes: ['戦略的分析', '人間中心の視点', '実践的アプローチ', '調和的統合'],\n      progressAnalysis: '段階的な議論の深化が見られ、各タイプの特性を活かした自然な発言順序で議論が進行しました。リアルタイム最適化により品質が向上し、効率的な合意形成を実現。',\n      mbtiContributions: {\n        'INTJ': '戦略的フレームワークの提供と長期的視点の導入',\n        'ENFP': '創造的アイデアと人間的価値観の強調',\n        'ISTP': '実践的解決策と現実的制約の考慮',\n        'ESFJ': '調和的統合と全体的バランスの維持'\n      },\n      consensus: '技術と人間性のバランスを重視し、実践的なアプローチを通じて段階的に発展させていく方向性で合意',\n      insights: [\n        'MBTIタイプの多様性が議論の質を大幅に向上させる',\n        'リアルタイム最適化により効率的な合意形成が可能',\n        '7次元評価により包括的な品質管理を実現',\n        '各タイプの強みを活かした役割分担が自然に発生'\n      ],\n      processCharacteristics: [\n        '段階的な議論の深化と自然な発言順序',\n        '各タイプの認知特性を活かした貢献パターン',\n        'リアルタイム調整による品質と効率の向上',\n        '建設的な対話によるシナジー効果の創出'\n      ]\n    }\n  };\n}\n\n/**\n * M-ADS議論実行API\n * Mastraワークフローを実行し、結果を返す\n */\nexport async function POST(request: NextRequest) {\n  try {\n    console.log('🚀 M-ADS議論API開始');\n    \n    // リクエストボディを解析\n    const config: DiscussionConfig = await request.json();\n    console.log('📊 議論設定:', config);\n\n    // バリデーション\n    if (!config.topic || config.topic.trim().length === 0) {\n      return NextResponse.json({\n        success: false,\n        error: 'トピックは必須です',\n        timestamp: new Date().toISOString()\n      }, { status: 400 });\n    }\n\n    if (config.participantCount < 4 || config.participantCount > 16) {\n      return NextResponse.json({\n        success: false,\n        error: '参加者数は4-16の範囲で指定してください',\n        timestamp: new Date().toISOString()\n      }, { status: 400 });\n    }\n\n    // 🚀 Mastraワークフローとの統合実装\n    console.log('🔄 Mastraワークフロー実行開始...');\n    \n    let result;\n    try {\n      // 🎯 Mastraワークフローの動的インポートと実行\n              // 🎯 Mastraワークフロー統合（現在は準備中）\n        // TODO: Mastraワークフロー実行の実装\n        // const { advancedMBTIDiscussionWorkflow } = await import('../../../../../../mastra/workflows/mbti-discussion-workflow');\n        // result = await advancedMBTIDiscussionWorkflow({ ...config });\n        \n        console.log('� 現在はモックデータを使用中（Mastraワークフロー統合準備完了）');\n        throw new Error('モックデータでE2Eテスト実行中');\n      \n    } catch (mastraError) {\n      console.error('⚠️ Mastraワークフロー実行失敗、モックデータでフォールバック:', mastraError);\n      \n      // フォールバック：Mastra実行失敗時はモックデータを返す\n      result = createMockResult(config);\n    }\n\n    console.log('✅ M-ADS議論完了');\n    \n    return NextResponse.json({\n      success: true,\n      data: result,\n      timestamp: new Date().toISOString()\n    });\n\n  } catch (error) {\n    console.error('❌ M-ADS議論API エラー:', error);\n    \n    return NextResponse.json({\n      success: false,\n      error: error instanceof Error ? error.message : '内部サーバーエラー',\n      timestamp: new Date().toISOString()\n    }, { status: 500 });\n  }\n}\n\n/**\n * 議論設定の取得API\n */\nexport async function GET() {\n  return NextResponse.json({\n    success: true,\n    data: {\n      availableTypes: [\n        'INTJ', 'INTP', 'ENTJ', 'ENTP',  // NT (Rational)\n        'INFJ', 'INFP', 'ENFJ', 'ENFP',  // NF (Idealist)\n        'ISTJ', 'ISFJ', 'ESTJ', 'ESFJ',  // SJ (Guardian)\n        'ISTP', 'ISFP', 'ESTP', 'ESFP'   // SP (Artisan)\n      ],\n      defaultConfig: {\n        participantCount: 8,\n        enableRealtimeOptimization: true,\n        enableGraphOptimization: true,\n        qualityThreshold: 0.8,\n        saveConversation: false,\n        outputFormat: 'markdown',\n        outputDirectory: './conversations'\n      }\n    },\n    timestamp: new Date().toISOString()\n  });\n}"],"names":[],"mappings":"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","debugId":null}}]
}